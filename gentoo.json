{
  "variables": {
    "mirror": "http://distfiles.gentoo.org/",
    "iso_file": "releases/amd64/autobuilds/20170720/install-amd64-minimal-20170720.iso",
    "iso_checksum": "892377c65fb7751907169df7955388fd27f41dda43821f9011db9234d0f2015a823ea04b6e36532a96c1beb320f38affd0b19f291ea1abcd128caa1c789fa1a9",
    "stage_file": "releases/amd64/autobuilds/20170720/stage4-amd64-minimal-20170720.tar.bz2",
    "stage_checksum": "b520e02eb0ab8aec57aeac0f8e0722a48923184c5792c7d51e6064625337ebf7fa3eaf4efa7cd5efbcff7746e2059be11966c6ec0bd33404f1091c0511f785a1",
    "vm_name": "Gentoo 64 Minimal",
    "vm_description": "Gentoo 64 Minimal Base Install",
    "vm_type": "Gentoo_64",
    "username": "root",
    "password": "packer"
  },
  "description": "{{user `vm_description`}}",
  "builders": [
    {
      "type": "virtualbox-iso",
      "vm_name": "{{user `vm_name`}}",
      "virtualbox_version_file": ".vbox_version",
      "headless": false,
      "keep_registered": true,
      "hard_drive_interface": "sata",

      "boot_wait": "5s",
      "boot_command": [
        "gentoo-nofb",
        "<enter>",
        "<wait10>",
        "<enter>",
        "<wait10>",
        "<wait10>",
        "<wait10>",
        "<wait10>",
        "<wait10>",
        "<wait10>",
        "passwd {{user `username`}}",
        "<enter>",
        "<wait>",
        "{{user `password`}}",
        "<enter>",
        "<wait>",
        "{{user `password`}}",
        "<enter>",
        "<wait>",
        "/etc/init.d/sshd start",
        "<enter>",
        "<wait>"
      ],

      "guest_os_type": "{{user `vm_type`}}",
      "disk_size": 24576,
      "guest_additions_mode": "disable",


      "iso_url": "{{user `mirror`}}/{{user `iso_file`}}",
      "iso_checksum": "{{user `iso_checksum`}}",
      "iso_checksum_type": "sha512",

      "ssh_password": "{{user `password`}}",
      "ssh_username": "{{user `username`}}",
      "ssh_wait_timeout": "2m",

      "vboxmanage": [
          ["modifyvm", "{{.Name}}", "--memory", "4096"],
          ["modifyvm", "{{.Name}}", "--cpus", "8"]
      ],

      "shutdown_command": "shutdown -hP now"
    }
  ],
  "post-processors": [
    {
      "type": "vagrant",
      "keep_input_artifact": true
    }
  ],
  "provisioners": [
    {
      "type": "file",
      "source": "scripts",
      "destination": "/tmp"
    },
    {
      "type": "file",
      "source": "kernel.config",
      "destination": "/tmp/kernel.config"
    },
    {
      "type": "shell",
      "remote_folder": "/tmp/scripts",
      "scripts": [
        "scripts/00_partition.sh",
        "scripts/10_stage.sh",
        "scripts/20_portage.sh",
        "scripts/30_mounts.sh",
        "scripts/40_make.conf.sh",
        "scripts/41_fstab.sh",
        "scripts/42_inittab.sh",
        "scripts/43_resolv.conf.sh",
        "scripts/44_timezone.sh",
        "scripts/45_package.keywords.sh",
        "scripts/46_network.sh",
        "scripts/47_sudoers.sh",
        "scripts/50_update.sh",
        "scripts/60_accounts.sh",
        "scripts/70_kernel.sh",
        "scripts/80_grub.sh",
        "scripts/98_virtualbox.sh",
        "scripts/99_cleanup.sh"

      ],
      "environment_vars": [
	"MIRROR={{user `mirror`}}",
        "STAGE_FILE={{user `stage_file`}}",
        "STAGE_CHECKSUM={{user `stage_checksum`}}",
        "VM_TYPE=virtualbox",
        "BASEDIR=/tmp"
      ]
    }
  ]
}
